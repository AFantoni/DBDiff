{"name":"DBDiff","tagline":"Compare MySQL databases & automatically create schema & data change scripts/migrations rapidly (up & down SQL supported) for database version control. Supports all migration tools.","body":"# DBDiff CLI - Database Diff Command Line Interface\r\n\r\n#The Problem\r\n\r\nI've found a few solid​ ​migrat​ion tools like [Flyway](https://github.com/flyway/flyway) and [Simple DB Migrate](https://github.com/guilhermechapiewski/simple-db-migrate)​, the latter being my preference for it's simplicity​ but the former having a lot more commits and contributors.​ However,​ these are just migrators and do not help produce the actual diff/migration to be versioned​, which I would not like to do manually if it can be automated.​\r\n\r\nI found a diff tool by MySQL called [mysqldbcompare](http://dev.mysql.com/doc/mysql-utilities/1.6/en/mysqldbcompare.html), which outputs SQL​ for (some) schema and data changes​ but it​ shockingly doesn't​ ​produce valid SQL!!!\r\n\r\nI must say though everything the mysqldbcompare tool offers is great, doing the diff by connecting directly to a source and target database (can be locally or on another server) and doing a series of tests/checks (all of which can be skipped if need be), then checking both the schema and the data - but we just need it to produce valid SQL output and I think it also had trouble in validating the schema fully.\r\n\r\n​​I actually looked through A LOT of ​different ​schema and data diff tools (took me a whole weekend) and they all either:\r\n\r\n1. Only do schema diffs\r\n2. Are just too complex to get working or\r\n3. Just don't produce valid SQL\r\n\r\n#The Solution\r\nI think a solid migration tool mixed with an automated schema and data diff tool would be a great contribution to the open source community.\r\n\r\nThis is what DBDiff is.\r\n\r\n#Features of DBDiff\r\n-   Works on Windows, Linux & Mac command-line/Terminal because it has been developed in PHP\r\n-   Connects to a source and target database to do the comparison diff, locally and remotely\r\n-   Diffs can include changes to the schema and/or data, both in valid SQL to bring the target up-to-date with the source\r\n-   Diffs are SUPER fast and this tool has been tested with databases of multiple tables of millions of rows\r\n-   Since this diff tool is being used for migrations, it provides up and down SQL in the same file\r\n-   Works with existing migration tools like Flyway and Simple DB Migrate by specifying output template files/formats, for example, Simple DB Migrate may work with simple-db-migrate.tmpl which includes: `SQL_UP = u\"\"\" {{ $up }} \"\"\" SQL_DOWN = u\"\"\" {{ $down }} \"\"\"`\r\n-   Is Unicode aware, can work with UTF8 data, which includes foreign characters/symbols\r\n-   Works with just MySQL for now, but we will be expanding to other DBs in the future on request (please create an issue!)\r\n\r\n# Command-Line API\r\n\r\n###### Note: The command-line parameters will always override the settings in the `.dbdiff` config file\r\n\r\n-   --server1=user:password@host1:port - Specify the source db connection details. If there is only one server the --server1 flag can be omitted\r\n-   --server2=user:password@host2:port - Specify the target db connection details (if it’s different to server1)\r\n-   --template=templates/simple-db-migrate.tmpl - Specifies the output template, if any. By default will be plain SQL\r\n-   --type=schema or data or all - Specifies the type of diff to do either on the schema, data or both. schema is the default\r\n-   --include=up or down or all - Specified whether to include the up, down or both data in the output. up is the default\r\n-   --no-comments=true - By default automated comments starting with the hash (\\#) character are included in the output file, which can be removed with this parameter\r\n-   --config=config.yaml - By default, DBDiff will look for a `.dbdiff` file in the current directory which is valid YAML, which may also be overridden with a config file that lists the database host, user, port and password of the source and target DBs in YAML format (instead of using the command line for it), or any of the other settings e.g. the format, template, type, include, no-comments. Please note: a command-line parameter will always override any config file.\r\n-   server1.db1.table1:server2.db2.table3 or server1.db1:server2.db2 - The penultimate parameter is what to compare. This tool can compare just one table or all tables (entire db) from the database\r\n-   --output=./output-dir/today-up-schema.sql - The last parameter is an output file and/or directory to output the diff to, which by default will output to the same directory the command is run in if no directory is specified. If a directory is specified, it should exist, otherwise an error will be thrown. If this path is not specified, the default file name becomes migration.sql in the current directory\r\n\r\n# Usage Examples\r\n\r\n## Example 1\r\n`$ ./dbdiff server1.db1:server2.db2`\r\n\r\nThis would by default look for the `.dbdiff` config file for the DB connection details, if it’s not there the tool would return an error. If it’s there, the connection details would be used to compare the SQL of only the schema and output a commented migration.sql file inside the current directory which includes only the up SQL as per default\r\n\r\n## Example 2\r\n`$ ./dbdiff server1.development.table1:server2.production.table1 --no-comments=true --type=data`\r\n\r\nThis would by default look for the `.dbdiff` config file for the DB connection details, if it’s not there the tool would return an error. If it’s there, the connection details would be used to compare the SQL of only the data of the specified table1 inside each database and output a .sql file which has no comments inside the current directory which includes only the up SQL as per default\r\n\r\n## Example 3\r\n`$ ./dbdiff --config=config.conf --template=templates/simple-db-migrate.tmpl --include=all server1.db1:server2.db2 --output=./sql/simple-schema.sql`\r\n\r\nInstead of looking for `.dbdiff`, this would look for `config.conf` (which should be valid YAML) for the settings, and then override any of those settings from `config.conf` for the --template and --include parameters given in the command-line parameters - thus comparing the source with the target database and outputting an SQL file called simple-schema.sql to the ./sql folder, which should already exist otherwise the program will throw an error, and which includes only the schema as an up and down SQL diff in the simple-db-migrate format (as specified by the template). This example would work perfectly alongside the simple-db-migrate tool\r\n\r\n# File Examples\r\n\r\n## .dbdiff\r\n\r\n\t\tserver1-user: user\r\n\t\tserver1-password: password\r\n\t\tserver1-port: port # for MySQL this is 3306\r\n\t\tserver1-host: host1 # usually localhost or 127.0.0.1\r\n\t\tserver2-user: user\r\n\t\tserver2-password: password\r\n\t\tserver2-port: port # for MySQL this is 3306\r\n\t\tserver2-host: host1 # usually localhost or 127.0.0.1\r\n\t\ttemplate: templates/simple-db-migrate.tmpl\r\n\t\ttype: all\r\n\t\tinclude: all\r\n\t\tno-comments: true\r\n\r\n## simple-db-migrate.tmpl\r\n\r\n\t\tSQL_UP = u\"\"\"\r\n\t\t{{ $up }}\r\n\t\t\"\"\"\r\n\t\tSQL_DOWN = u\"\"\"\r\n\t\t{{ $down }}\r\n\t\t\"\"\"\r\n\r\n# How Does the Diff Actually Work?\r\n\r\nThe following comparisons run in exactly the following order:\r\n\r\n-   When comparing multiple tables: all comparisons should be run\r\n-   When comparing just one table with another: only run the schema and data comparisons\r\n\r\n## Overall Comparison\r\n-   Check both databases exist and are accessible, if not, throw an error\r\n-   The database collation is then compared between the source and the target and any differences noted for the output\r\n\r\n## Schema Comparison\r\n-   Looks to see if there are any differences in column numbers, name, type, collation or attributes\r\n-   Any new columns in the source, which are not found in the target, are added\r\n\r\n## Data Comparison\r\n-   And then for each table, the table storage type (e.g. MyISAM, CSV), the collation (e.g. utf8\\_general\\_ci), and number of rows are compared, in that order. If there are any differences they are noted before moving onto the next test\r\n-   Next, both changed rows as well as missing rows from each table are recorded\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}